# CapsuleChord 2 キーパッドファームウェア

ユーザーが押下する操作に反応する物理的な装置を「ボタン」
ファームウェア内で扱う論理的な入力の最小単位を「キー」と呼ぶことにします

## ボタン感度調整方法

各ボタンの感度（閾値）はシリアル通信経由で調整できます。調整した値はフラッシュメモリに保存され、電源を切っても保持されます。

### シリアル通信の設定

- ボーレート: 115200
- データビット: 8
- パリティ: なし
- ストップビット: 1
- フロー制御: なし

### 利用可能なコマンド

シリアルターミナル（Screen、CoolTerm、Terraterm等）を使用して以下のコマンドを送信できます：

- `threshold` - すべてのキーの閾値を表示
- `threshold <key>` - 特定のキーの閾値を表示（例: `threshold 0x01`）
- `threshold <key> <value>` - 特定のキーの閾値を設定（例: `threshold 0x01 3800`）
- `save` - 現在の設定をフラッシュメモリに保存
- `load` - フラッシュメモリから設定を読み込み
- `default` - デフォルト設定に戻す（保存はされない）
- `help` - コマンド一覧を表示

### キーコード一覧

閾値を調整する際のキーコード：

```
# 左キーパッド
0x01: KEY_LEFT_1
0x02: KEY_LEFT_2
0x03: KEY_LEFT_3
0x04: KEY_LEFT_4
0x05: KEY_LEFT_5
0x06: KEY_LEFT_6
0x07: KEY_LEFT_7
0x08: KEY_LEFT_8
0x09: KEY_LEFT_9

# 右キーパッド
0x11: KEY_RIGHT_1
0x12: KEY_RIGHT_2
0x13: KEY_RIGHT_3
0x14: KEY_RIGHT_4
0x15: KEY_RIGHT_5
0x16: KEY_RIGHT_6
0x17: KEY_RIGHT_7
0x18: KEY_RIGHT_8
0x19: KEY_RIGHT_9

# その他のボタン
0x21: KEY_L
0x22: KEY_R
0x23: KEY_LT
0x24: KEY_RT
```

### 使用例

1. すべてのキーの現在の閾値を確認：
   ```
   threshold
   ```

2. 特定のキーの閾値を確認（例：左キーパッドの1）：
   ```
   threshold 0x01
   ```

3. 特定のキーの閾値を変更（例：左キーパッドの1の閾値を3800に設定）：
   ```
   threshold 0x01 3800
   ```

4. 変更した設定をフラッシュメモリに保存：
   ```
   save
   ```

5. デフォルト設定に戻す：
   ```
   default
   ```
   
   その後、保存するには：
   ```
   save
   ```

### 注意事項

- 閾値が低すぎると、ボタンを押していないときにも押されていると誤認識する可能性があります
- 閾値が高すぎると、ボタンを押しても反応しにくくなる可能性があります
- フラッシュメモリへの書き込みには寿命があるため、テストの間は頻繁に`save`コマンドを使用せず、最終的な設定が決まったときだけ使用することをお勧めします
